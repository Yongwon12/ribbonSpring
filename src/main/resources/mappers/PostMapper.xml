<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.ribbon.mapper.PostMapper">

    <!-- boardwrite 테이블 전체 컬럼 -->
    <sql id="postColumns">
        id
        , userid
        , title
        , description
        , img
        , writedate
        , nickname
        , boardid
        , likedcount
        , commentcount

    </sql>

    <!-- groupwrite 테이블 전체 컬럼 -->
    <sql id="postGroupColumns">
        id
        , region
        , title
        , line
        , description
        , peoplenum
        , gender
        , minage
        , titleimage
        , userid
        , maxage
        , writedate
        , peoplenownum
        , nickname
        , groupid
        , once
        , commentcount
    </sql>

    <!-- individualwrite 테이블 전체 컬럼 -->
    <sql id="postIndiColumns">
        id
        , region
        , meetdate
        , title
        , description
        , gender
        , userid
        , writedate
        , maxage
        , minage
        , nickname
        , individualid
        , likedcount
        , commentcount
    </sql>

    <!-- usedwrite 테이블 전체 컬럼 -->
    <sql id="postUsedColumns">
        id
        , region
        , title
        , description
        , usedimage1
        , price
        , userid
        , writedate
        , nickname
        , usedid
        , usedimage2
        , usedimage3
        , usedimage4
        , usedimage5
        , likedcount
        , commentcount
    </sql>

    <!-- User 테이블 전체 컬럼 -->
    <sql id="postUserColumns">
        userid
        , username
        , sns
        , email
        , nickname
        , mobile
        , createdate
        , modifydate
        , birth
        , profileimage
        , gender
        , bestcategory
        , shortinfo
            , youtube
            , token
            , password
    </sql>

    <!-- liked 테이블 전체 컬럼 -->
    <sql id="postLikedColumns">
        categoryid
        , userid
        , inherentid
    </sql>

    <!-- comments 테이블 전체 컬럼 -->
    <sql id="postCommentsColumns">
        description
        , userid
        , nickname
        , categoryid
        , inherentid
        , writedate
        , commentsid
        , isrecomment
    </sql>

    <!-- groupcomments 테이블 전체 컬럼 -->
    <sql id="postGroupCommentsColumns">
        description
        , userid
        , nickname
        , inherentid
        , writedate
        , commentsid
        , isrecomment
    </sql>

    <!-- individualcomments 테이블 전체 컬럼 -->
    <sql id="postIndividualCommentsColumns">
        description
        , userid
        , nickname
        , inherentid
        , writedate
        , commentsid
        , isrecomment
    </sql>

    <!-- usedcomments 테이블 전체 컬럼 -->
    <sql id="postUsedCommentsColumns">
        description
        , userid
        , nickname
        , inherentid
        , writedate
        , commentsid
        , isrecomment
    </sql>

    <!-- chatroom 테이블 전체 컬럼 -->
    <sql id="postChatRoomColumns">
        id
        , roomname
        , myid
        , yourid
        , mynickname
        , yournickname
        , myprofileimage
            , yourprofileimage
    </sql>

    <!-- 커뮤니티 게시글 저장 -->
    <insert id="save" parameterType="com.project.ribbon.domain.post.PostRequest"
            useGeneratedKeys="true" keyProperty="boardid">
        INSERT INTO boardwrite (
        <include refid="postColumns" />
        ) VALUES (
        #{id}
        , #{userid}
        , #{title}
        , #{description}
        , #{img}
        , #{writedate}
        , #{nickname}
        , #{boardid}
        , 0
        , 0
        )
    </insert>


    <!-- 커뮤니티 게시글 수정 -->
    <update id="update" parameterType="com.project.ribbon.domain.post.PostRequest">
        UPDATE boardwrite
        SET
            title = #{title}
          , description = #{description}
          , img = #{img}
          , writedate = #{writedate}
          , profileimage = #{profileimage}
        WHERE
            boardid = #{boardid}
    </update>


    <!-- 커뮤니티 게시글  조회 -->
    <select id="findAll" resultType="com.project.ribbon.domain.post.PostResponse" fetchSize="1000">
        SELECT
            id,User.userid,title,description,img,writedate,User.nickname,
            boardid,likedcount,commentcount,profileimage,token
        FROM boardwrite
                 LEFT JOIN User
                           ON User.userid = boardwrite.userid
    </select>

    <!-- 커뮤니티 특정게시글  조회 -->
    <select id="findOne" resultType="com.project.ribbon.domain.post.PostResponse">
        SELECT
            id,User.userid,title,description,img,writedate,User.nickname,
            boardid,likedcount,commentcount,profileimage,token
        FROM boardwrite
                 LEFT JOIN User
                           ON User.userid = boardwrite.userid
        WHERE boardid = #{boardid}
    </select>


    <!-- 커뮤니티 게시글 삭제 -->
    <delete id="deleteById" >
        DELETE
        FROM
            boardwrite
        where boardid = #{boardid}
    </delete>

    <!-- 단체 게시글 조회  -->
    <select id="findGroupAll" resultType="com.project.ribbon.domain.post.PostGroupResponse" fetchSize="1000">
        SELECT
            id,region,title,line,description,peoplenum,groupwrite.gender,minage,titleimage,
            groupwrite.userid,maxage,writedate,peoplenownum,user.nickname,groupid,once,commentcount,token,profileimage
        FROM
            groupwrite
                LEFT JOIN User
                          ON User.userid = groupwrite.userid
    </select>

    <!-- 단체 특정 게시글 조회  -->
    <select id="findGroupOne" resultType="com.project.ribbon.domain.post.PostGroupResponse">
        SELECT
            id,region,title,line,description,peoplenum,groupwrite.gender,minage,titleimage,
            groupwrite.userid,maxage,writedate,peoplenownum,user.nickname,groupid,once,commentcount,token,profileimage
        FROM
            groupwrite
                LEFT JOIN User
                          ON User.userid = groupwrite.userid
        WHERE groupid = #{groupid}
    </select>

    <!-- 단체 게시글 저장 -->
    <insert id="saveGroup" parameterType="com.project.ribbon.domain.post.PostGroupRequest"
            useGeneratedKeys="true" keyProperty="groupid">
        INSERT INTO groupwrite (
        <include refid="postGroupColumns" />
        ) VALUES (
        #{id}
        , #{region}
        , #{title}
        , #{line}
        , #{description}
        , #{peoplenum}
        , #{gender}
        , #{minage}
        , #{titleimage}
        , #{userid}
        , #{maxage}
        , #{writedate}
        , #{peoplenownum}
        , #{nickname}
        , #{groupid}
        , #{once}
        , 0
        )
    </insert>

    <!-- 단체 게시글 수정 -->
    <update id="updateGroup" parameterType="com.project.ribbon.domain.post.PostGroupRequest">
        UPDATE groupwrite
        SET
            region = #{region}
          , title = #{title}
          , line = #{line}
          , description = #{description}
          , peoplenum = #{peoplenum}
          , minage = #{minage}
          , titleimage = #{titleimage}
          , maxage = #{maxage}
          , writedate = #{writedate}
          , peoplenownum = #{peoplenownum}
          , once = #{once}
        WHERE
            groupid = #{groupid}
    </update>

    <!-- 단체 게시글 삭제 -->
    <delete id="deleteByGroupId" >
        DELETE
        FROM
            groupwrite
        WHERE groupid = #{groupid}
    </delete>


    <!-- 개인 게시글 조회  -->
    <select id="findIndiAll" resultType="com.project.ribbon.domain.post.PostIndiResponse" fetchSize="1000">
        SELECT
            id,region,meetdate,title,description,individualwrite.gender,
            individualwrite.userid,writedate,maxage,minage,user.nickname,
            individualid,likedcount,commentcount,profileimage,token
        FROM
            individualwrite
                LEFT JOIN User
                          ON User.userid = individualwrite.userid

    </select>

    <!-- 개인 특정 게시글 조회  -->
    <select id="findIndiOne" resultType="com.project.ribbon.domain.post.PostIndiResponse">
        SELECT
            id,region,meetdate,title,description,individualwrite.gender,
            individualwrite.userid,writedate,maxage,minage,user.nickname,
            individualid,likedcount,commentcount,profileimage,token
        FROM
            individualwrite
                LEFT JOIN User
                          ON User.userid = individualwrite.userid
        WHERE individualid = #{individualid}
    </select>

    <!-- 개인 게시글 저장 -->
    <insert id="saveIndi" parameterType="com.project.ribbon.domain.post.PostIndiRequest"
            useGeneratedKeys="true" keyProperty="individualid">
        INSERT INTO individualwrite (
        <include refid="postIndiColumns" />
        ) VALUES (
        #{id}
        , #{region}
        , #{meetdate}
        , #{title}
        , #{description}
        , #{gender}
        , #{userid}
        , #{writedate}
        , #{maxage}
        , #{minage}
        , #{nickname}
        , #{individualid}
        , 0
        , 0
        )
    </insert>

    <!-- 개인 게시글 수정 -->
    <update id="updateIndi" parameterType="com.project.ribbon.domain.post.PostIndiRequest">
        UPDATE individualwrite
        SET
            region = #{region}
          , meetdate = #{meetdate}
          , title = #{title}
          , description = #{description}
          , writedate = #{writedate}
          , maxage = #{maxage}
          , minage = #{minage}
        WHERE
            individualid = #{individualid}
    </update>


    <!-- 개인 게시글 삭제 -->
    <delete id="deleteByIndiId" >
        DELETE
        FROM
            individualwrite
        WHERE individualid = #{individualid}
    </delete>

    <!-- 중고 게시글 조회  -->
    <select id="findUsedAll" resultType="com.project.ribbon.domain.post.PostUsedResponse" fetchSize="1000">
        SELECT
            id,region,title,description,usedimage1,price,User.userid,writedate,user.nickname,
            usedid,usedimage2,usedimage3,usedimage4,usedimage5,likedcount,commentcount,token,profileimage
        FROM
            usedwrite
                LEFT JOIN User
                          ON User.userid = usedwrite.userid
    </select>

    <!-- 중고 특정 게시글 조회  -->
    <select id="findUsedOne" resultType="com.project.ribbon.domain.post.PostUsedResponse">
        SELECT
            id,region,title,description,usedimage1,price,User.userid,writedate,user.nickname,
            usedid,usedimage2,usedimage3,usedimage4,usedimage5,likedcount,commentcount,token,profileimage
        FROM
            usedwrite
                LEFT JOIN User
                          ON User.userid = usedwrite.userid
        WHERE usedid = #{usedid}
    </select>

    <!-- 중고 게시글 저장 -->
    <insert id="saveUsed" parameterType="com.project.ribbon.domain.post.PostUsedRequest"
            useGeneratedKeys="true" keyProperty="usedid">
        INSERT INTO usedwrite (
        <include refid="postUsedColumns" />
        ) VALUES (
        #{id}
        , #{region}
        , #{title}
        , #{description}
        , #{usedimage1}
        , #{price}
        , #{userid}
        , #{writedate}
        , #{nickname}
        , #{usedid}
        , #{usedimage2}
        , #{usedimage3}
        , #{usedimage4}
        , #{usedimage5}
        , 0
        , 0
        )
    </insert>

    <!-- 중고 게시글 수정 -->
    <update id="updateUsed" parameterType="com.project.ribbon.domain.post.PostUsedRequest">
        UPDATE usedwrite
        SET
            region = #{region}
          , title = #{title}
          , description = #{description}
          , usedimage1 = #{usedimage1}
          , price = #{price}
          , writedate = #{writedate}
          , usedimage2 = #{usedimage2}
          , usedimage3 = #{usedimage3}
          , usedimage4 = #{usedimage4}
          , usedimage5 = #{usedimage5}
        WHERE
            usedid = #{usedid}
    </update>

    <!-- 중고 게시글 삭제 -->
    <delete id="deleteByUsedId" >
        DELETE
        FROM
            usedwrite
        where usedid = #{usedid}
    </delete>


    <!-- 기존 유저 정보 조회  -->
    <select id="findUserInfoAll" resultType="com.project.ribbon.domain.post.PostUserRequest">
        SELECT
            *
        FROM
            user
        WHERE
            email = #{email}
    </select>


    <!-- 유저 가입 -->
    <insert id="saveUser" parameterType="com.project.ribbon.domain.post.PostUserRequest"
            useGeneratedKeys="true" keyProperty="userid" >
        INSERT INTO User (
        <include refid="postUserColumns" />
        ) VALUES(
        #{userid}
        , #{username}
        , #{sns}
        , #{email}
        , #{nickname}
        , #{mobile}
        , #{createdate}
        , #{modifydate}
        , #{birth}
        , #{profileimage}
        , #{gender}
        , #{bestcategory}
        , #{shortinfo}
        , #{youtube}
        , #{token}
        , #{password})
        ON DUPLICATE KEY UPDATE
        token = VALUES(token),
        password = VALUES(password)

        <selectKey keyProperty="userid" order="AFTER" resultType="java.lang.Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <!-- 유저 가입 -->
    <insert id="saveUserRoles" parameterType="com.project.ribbon.domain.post.PostUserRequest"
    >
        INSERT INTO user_roles (
        user_userid,roles,email
        ) VALUES (
        #{userid}
        , "USER"
        , #{email})
        ON DUPLICATE KEY UPDATE
        roles = VALUES(roles)

    </insert>


    <!-- 유저 프로필 수정 -->
    <update id="updateUser" parameterType="com.project.ribbon.domain.post.PostUserUpdateRequest">
        UPDATE User
        SET
            sns = #{sns}
          , nickname = #{nickname}
          , modifydate = #{modifydate}
          , bestcategory = #{bestcategory}
          , shortinfo = #{shortinfo}
          , youtube = #{youtube}
          , profileimage = #{profileimage}
        WHERE
            userid = #{userid}
    </update>

    <!-- 유저 수정된 프사 조회  -->
    <select id="findUserImage" resultType="com.project.ribbon.domain.post.PostUserUpdateRequest">
        SELECT
            *
        FROM
            user
        WHERE userid = #{userid}
    </select>


    <!-- 유저 정보 삭제 -->
    <delete id="deleteByUserId" >
        DELETE
        FROM
            User
        WHERE userid = #{userid}
    </delete>

    <!-- 유저 권한 정보 삭제 -->
    <delete id="deleteByUserRolesId" >
        DELETE
        FROM
            user_roles
        WHERE user_userid = #{userid}
    </delete>



    <!-- 실시간 인기글 -->
    <select id="findAll11" resultType="com.project.ribbon.domain.post.PostResponse">
        SELECT
            id,boardwrite.userid,title,description,img,writedate,User.nickname,
            boardid,likedcount,commentcount,profileimage,token
        FROM boardwrite
                 LEFT JOIN User
                           ON User.userid=boardwrite.userid
        WHERE
                likedcount
                = (SELECT max(likedcount) FROM boardwrite)
        ORDER BY
            boardid
                DESC
            limit 1
    </select>


    <!-- 좋아요 삽입 -->
    <insert id="saveLiked" parameterType="com.project.ribbon.domain.post.PostLikedRequest"
    >
        INSERT INTO liked (
        <include refid="postLikedColumns" />
        ) VALUES (
        #{categoryid}
        , #{userid}
        , #{inherentid}
        )
    </insert>



    <!-- 좋아요 갯수 카운트 +1 -->
    <update id="updateLiked" parameterType="com.project.ribbon.domain.post.PostLikedRequest">

        UPDATE boardwrite SET likedcount = likedcount + 1 WHERE boardid = #{inherentid}

    </update>
    <!-- 좋아요 갯수 카운트 -1 -->
    <update id="updateDeleteLiked" parameterType="com.project.ribbon.domain.post.PostLikedRequest">

        UPDATE boardwrite SET likedcount = likedcount - 1 WHERE boardid = #{inherentid}

    </update>


    <!-- 좋아요 삭제 -->
    <delete id="deleteByLikedId" >
        DELETE
        FROM
            liked
        WHERE categoryid = #{categoryid}
          AND userid = #{userid}
          AND inherentid = #{inherentid}
    </delete>


    <!-- 개인 좋아요 삽입 -->
    <insert id="saveIndividualLiked" parameterType="com.project.ribbon.domain.post.PostIndividualLikedRequest"
    >
        INSERT INTO individualliked (
        <include refid="postLikedColumns" />
        ) VALUES (
        #{categoryid}
        , #{userid}
        , #{inherentid}
        )

    </insert>


    <!-- 개인 좋아요 갯수 카운트 +1 -->
    <update id="updateIndividualLiked" parameterType="com.project.ribbon.domain.post.PostIndividualLikedRequest">

        UPDATE individualwrite SET likedcount = likedcount + 1 WHERE individualid = #{inherentid}

    </update>
    <!-- 개인 좋아요 갯수 카운트 -1 -->
    <update id="updateDeleteIndividualLiked" parameterType="com.project.ribbon.domain.post.PostIndividualLikedRequest">

        UPDATE individualwrite SET likedcount = likedcount - 1 WHERE individualid = #{inherentid}

    </update>

    <!-- 개인 좋아요 삭제 -->
    <delete id="deleteByIndividualLikedId" >
        DELETE
        FROM
            individualliked
        WHERE categoryid = #{categoryid}
          AND userid = #{userid}
          AND inherentid = #{inherentid}
    </delete>


    <!-- 중고 좋아요 삽입 -->
    <insert id="saveUsedLiked" parameterType="com.project.ribbon.domain.post.PostUsedLikedRequest"
    >
        INSERT INTO usedliked (
        <include refid="postLikedColumns" />
        ) VALUES (
        #{categoryid}
        , #{userid}
        , #{inherentid}
        )
    </insert>


    <!-- 중고 좋아요 갯수 카운트 +1 -->
    <update id="updateUsedLiked" parameterType="com.project.ribbon.domain.post.PostUsedLikedRequest">

        UPDATE usedwrite SET likedcount = likedcount + 1 WHERE usedid = #{inherentid}

    </update>
    <!-- 중고 좋아요 갯수 카운트 -1 -->
    <update id="updateDeleteUsedLiked" parameterType="com.project.ribbon.domain.post.PostUsedLikedRequest">

        UPDATE usedwrite SET likedcount = likedcount - 1 WHERE usedid = #{inherentid}

    </update>


    <!-- 중고 좋아요 삭제 -->
    <delete id="deleteByUsedLikedId" >
        DELETE
        FROM
            usedliked
        WHERE categoryid = #{categoryid}
          AND userid = #{userid}
          AND inherentid = #{inherentid}
    </delete>


    <!-- 댓글 작성자 아이디 조회  -->
    <select id="findCommentsId" resultType="com.project.ribbon.domain.post.PostCommentsIdResponse">
        SELECT
            commentsid
        FROM
            comments
        ORDER BY commentsid DESC limit 1
    </select>


    <!-- 댓글 정보 조회  -->
    <select id="findByInherentId" resultType="com.project.ribbon.domain.post.PostCommentsResponse" fetchSize="1000">
        SELECT
            description,writedate,comments.userid,User.nickname,categoryid,
            inherentid,commentsid,isrecomment,
            profileimage
        FROM comments
                 LEFT JOIN User
                           ON User.userid = comments.userid
        WHERE inherentid = #{inherentid}
    </select>


    <!-- 댓글 작성 -->
    <insert id="saveComments" parameterType="com.project.ribbon.domain.post.PostCommentsRequest"
            useGeneratedKeys="true" keyProperty="commentsid">
        INSERT INTO comments (
        <include refid="postCommentsColumns" />
        ) VALUES (
        #{description}
        , #{userid}
        , #{nickname}
        , #{categoryid}
        , #{inherentid}
        , #{writedate}
        , #{commentsid}
        , 2
        )

    </insert>


    <!-- 댓글 갯수 카운트 +1 -->
    <update id="updateCommentsCount" parameterType="com.project.ribbon.domain.post.PostCommentsRequest">

        UPDATE boardwrite SET commentcount = commentcount + 1 WHERE boardid = #{inherentid}

    </update>
    <!-- 댓글 갯수 카운트 -1 -->
    <update id="updateDeleteCommentsCount" parameterType="com.project.ribbon.domain.post.PostCommentsRequest">

        UPDATE boardwrite SET commentcount = commentcount - 1 WHERE boardid = #{inherentid}

    </update>


    <!-- 댓글 수정 -->
    <update id="updateComments" parameterType="com.project.ribbon.domain.post.PostCommentsRequest">
        UPDATE comments
        SET
            description = #{description}
          , nickname = #{nickname}
          , writedate = #{writedate}
        WHERE
            commentsid = #{commentsid}
    </update>


    <!-- 댓글 정보 삭제 -->
    <delete id="deleteComments" >
        DELETE
        FROM
            comments
        WHERE commentsid = #{commentsid}
    </delete>



    <!-- 단체 댓글 작성자 아이디 조회  -->
    <select id="findGroupCommentsId" resultType="com.project.ribbon.domain.post.PostGroupCommentsIdResponse">
        SELECT
            commentsid
        FROM
            groupcomments
        ORDER BY commentsid DESC limit 1
    </select>


    <!-- 단체 댓글 정보 조회  -->
    <select id="findByGroupCommentsInherentId" resultType="com.project.ribbon.domain.post.PostGroupCommentsResponse" fetchSize="1000">
        SELECT
            description,groupcomments.userid,User.nickname,inherentid,
            writedate,commentsid,isrecomment,profileimage
        FROM groupcomments
                 LEFT JOIN User
                           ON User.userid = groupcomments.userid
        WHERE inherentid = #{inherentid}
    </select>


    <!-- 단체 댓글 작성 -->
    <insert id="saveGroupComments" parameterType="com.project.ribbon.domain.post.PostGroupCommentsRequest"
            useGeneratedKeys="true" keyProperty="commentsid">
        INSERT INTO groupcomments (
        <include refid="postGroupCommentsColumns" />
        ) VALUES (
        #{description}
        , #{userid}
        , #{nickname}
        , #{inherentid}
        , #{writedate}
        , #{commentsid}
        , 2
        )

    </insert>


    <!-- 단체 댓글 갯수 카운트 +1 -->
    <update id="updateGroupCommentsCount" parameterType="com.project.ribbon.domain.post.PostGroupCommentsRequest">

        UPDATE groupwrite SET commentcount = commentcount + 1 WHERE groupid = #{inherentid}

    </update>
    <!-- 단체 댓글 갯수 카운트 -1 -->
    <update id="updateDeleteGroupCommentsCount" parameterType="com.project.ribbon.domain.post.PostGroupCommentsRequest">

        UPDATE groupwrite SET commentcount = commentcount - 1 WHERE groupid = #{inherentid}

    </update>


    <!-- 단체 댓글 수정 -->
    <update id="updateGroupComments" parameterType="com.project.ribbon.domain.post.PostGroupCommentsRequest">
        UPDATE groupcomments
        SET
            description = #{description}
          , nickname = #{nickname}
          , writedate = #{writedate}
        WHERE
            commentsid = #{commentsid}
    </update>


    <!-- 단체 댓글 정보 삭제 -->
    <delete id="deleteGroupComments" >
        DELETE
        FROM
            groupcomments
        WHERE commentsid = #{commentsid}
    </delete>


    <!-- 개인 댓글 작성자 아이디 조회  -->
    <select id="findIndiCommentsId" resultType="com.project.ribbon.domain.post.PostIndiCommentsIdResponse">
        SELECT
            commentsid
        FROM
            individualcomments
        ORDER BY commentsid DESC limit 1
    </select>



    <!-- 개인 댓글 정보 조회  -->
    <select id="findByIndiCommentsInherentId" resultType="com.project.ribbon.domain.post.PostIndiCommentsResponse" fetchSize="1000">
        SELECT
            description,individualcomments.userid,User.nickname,inherentid,
            writedate,commentsid,isrecomment,profileimage
        FROM individualcomments
                 LEFT JOIN User
                           ON User.userid = individualcomments.userid
        WHERE inherentid = #{inherentid}
    </select>


    <!-- 개인 댓글 작성 -->
    <insert id="saveIndiComments" parameterType="com.project.ribbon.domain.post.PostIndiCommentsRequest"
            useGeneratedKeys="true" keyProperty="commentsid">
        INSERT INTO individualcomments (
        <include refid="postIndividualCommentsColumns" />
        ) VALUES (
        #{description}
        , #{userid}
        , #{nickname}
        , #{inherentid}
        , #{writedate}
        , #{commentsid}
        , 2
        )

    </insert>

    <!-- 개인 댓글 갯수 카운트 +1 -->
    <update id="updateIndiCommentsCount" parameterType="com.project.ribbon.domain.post.PostIndiCommentsRequest">

        UPDATE individualwrite SET commentcount = commentcount + 1 WHERE individualid = #{inherentid}

    </update>
    <!-- 개인 댓글 갯수 카운트 -1 -->
    <update id="updateDeleteIndiCommentsCount" parameterType="com.project.ribbon.domain.post.PostIndiCommentsRequest">

        UPDATE individualwrite SET commentcount = commentcount - 1 WHERE individualid = #{inherentid}

    </update>

    <!-- 개인 댓글 수정 -->
    <update id="updateIndiComments" parameterType="com.project.ribbon.domain.post.PostIndiCommentsRequest">
        UPDATE individualcomments
        SET
            description = #{description}
          , nickname = #{nickname}
          , writedate = #{writedate}
        WHERE
            commentsid = #{commentsid}
    </update>


    <!-- 개인 댓글 정보 삭제 -->
    <delete id="deleteIndiComments" >
        DELETE
        FROM
            individualcomments
        WHERE commentsid = #{commentsid}
    </delete>


    <!-- 중고 댓글 작성자 아이디 조회  -->
    <select id="findUsedCommentsId" resultType="com.project.ribbon.domain.post.PostUsedCommentsIdResponse">
        SELECT
            commentsid
        FROM
            usedcomments
        ORDER BY commentsid DESC limit 1
    </select>


    <!-- 중고 댓글 정보 조회  -->
    <select id="findByUsedCommentsInherentId" resultType="com.project.ribbon.domain.post.PostUsedCommentsResponse">
        SELECT
            description,usedcomments.userid,User.nickname,inherentid,
            writedate,commentsid,isrecomment,profileimage
        FROM usedcomments
                 LEFT JOIN User
                           ON User.userid = usedcomments.userid
        WHERE inherentid = #{inherentid}
    </select>


    <!-- 중고 댓글 작성 -->
    <insert id="saveUsedComments" parameterType="com.project.ribbon.domain.post.PostUsedCommentsRequest"
            useGeneratedKeys="true" keyProperty="commentsid">
        INSERT INTO usedcomments (
        <include refid="postUsedCommentsColumns" />
        ) VALUES (
        #{description}
        , #{userid}
        , #{nickname}
        , #{inherentid}
        , #{writedate}
        , #{commentsid}
        , 2
        )

    </insert>

    <!-- 중고 댓글 갯수 카운트 +1 -->
    <update id="updateUsedCommentsCount" parameterType="com.project.ribbon.domain.post.PostUsedCommentsRequest">

        UPDATE usedwrite SET commentcount = commentcount + 1 WHERE usedid = #{inherentid}

    </update>
    <!-- 중고 댓글 갯수 카운트 -1 -->
    <update id="updateDeleteUsedCommentsCount" parameterType="com.project.ribbon.domain.post.PostUsedCommentsRequest">

        UPDATE usedwrite SET commentcount = commentcount - 1 WHERE usedid = #{inherentid}

    </update>


    <!-- 중고 댓글 수정 -->
    <update id="updateUsedComments" parameterType="com.project.ribbon.domain.post.PostUsedCommentsRequest">
        UPDATE usedcomments
        SET
            description = #{description}
          , nickname = #{nickname}
          , writedate = #{writedate}
        WHERE
            commentsid = #{commentsid}
    </update>


    <!-- 중고 댓글 정보 삭제 -->
    <delete id="deleteUsedComments" >
        DELETE
        FROM
            usedcomments
        WHERE commentsid = #{commentsid}
    </delete>


    <!-- 특정 유저 프로필 조회  -->
    <select id="findById" parameterType="Long" resultType="com.project.ribbon.domain.post.UserInfoResponse">
        SELECT
            userid,nickname,bestcategory,profileimage,shortinfo,sns,youtube
        FROM
            User
        WHERE
            userid = #{userid}
    </select>


    <!-- 커뮤니티 내가 쓴 글  -->
    <select id="findByMyUserId" parameterType="Long" resultType="com.project.ribbon.domain.post.PostMyBoardResponse">
        SELECT
            id,boardwrite.userid,title,description,img,writedate,User.nickname,
            boardid,likedcount,commentcount,profileimage
        FROM boardwrite
                 LEFT JOIN User
                           ON User.userid=boardwrite.userid
        WHERE
            boardwrite.userid = #{userid}
    </select>


    <!-- 단체 내가 쓴 글  -->
    <select id="findByMyGroupUserId" parameterType="Long" resultType="com.project.ribbon.domain.post.PostMyGroupResponse">
        SELECT
            id,region,title,line,description,peoplenum,
            groupwrite.gender,minage,titleimage,groupwrite.userid,maxage,
            writedate,peoplenownum,User.nickname,groupid,once,commentcount,profileimage
        FROM
            groupwrite
                LEFT JOIN User
                          ON User.userid = groupwrite.userid
        WHERE
            groupwrite.userid = #{userid}
    </select>


    <!-- 개인 내가 쓴 글  -->
    <select id="findByMyIndividualUserId" parameterType="Long" resultType="com.project.ribbon.domain.post.PostMyIndiResponse">
        SELECT
            id,region,meetdate,title,description,individualwrite.gender,
            individualwrite.userid,writedate,maxage,minage,User.nickname,
            individualid,likedcount,commentcount,profileimage
        FROM
            individualwrite
                LEFT JOIN User
                          ON User.userid = individualwrite.userid
        WHERE
            individualwrite.userid = #{userid}
    </select>


    <!-- 중고 내가 쓴 글  -->
    <select id="findByMyUsedUserId" parameterType="Long" resultType="com.project.ribbon.domain.post.PostMyUsedResponse">
        SELECT
            id,region,title,description,usedimage1,price,usedwrite.userid,
            writedate,User.nickname,usedid,usedimage2,usedimage3,usedimage4,
            usedimage5,likedcount,commentcount,profileimage
        FROM
            usedwrite
                LEFT JOIN User
                          ON User.userid = usedwrite.userid
        WHERE
            usedwrite.userid = #{userid}
    </select>


    <!-- 내가 좋아요 누른 글 커뮤니티 -->
    <select id="findByMyLikedUserId" parameterType="Long" resultType="com.project.ribbon.domain.post.PostMyLikedResponse">
        SELECT
            id,boardwrite.userid,title,description,img,writedate,User.nickname,
            boardid,likedcount,commentcount,profileimage
        FROM boardwrite
                 LEFT JOIN liked
                           ON liked.inherentid=boardwrite.boardid
                 LEFT JOIN User
                           ON User.userid = boardwrite.userid
        WHERE liked.userid = #{userid}
    </select>


    <!-- 내가 좋아요 누른 글 개인 -->
    <select id="findByMyIndividualLikedUserId" parameterType="Long" resultType="com.project.ribbon.domain.post.PostMyIndividualLikedResponse">
        SELECT
            id,region,meetdate,title,description,individualwrite.gender,
            individualwrite.userid,writedate,maxage,minage,User.nickname,
            individualid,likedcount,commentcount,profileimage
        FROM
            individualwrite
                LEFT JOIN individualliked
                          ON individualliked.inherentid=individualwrite.individualid
                LEFT JOIN User
                          ON User.userid = individualwrite.userid
        WHERE individualliked.userid = #{userid}
    </select>


    <!-- 내가 좋아요 누른 글 중고 -->
    <select id="findByMyUsedLikedUserId" parameterType="Long" resultType="com.project.ribbon.domain.post.PostMyUsedLikedResponse">
        SELECT
            id,region,title,description,usedimage1,price,usedwrite.userid,
            writedate,User.nickname,usedid,usedimage2,usedimage3,usedimage4,
            usedimage5,likedcount,commentcount,profileimage
        FROM
            usedwrite
                LEFT JOIN usedliked
                          ON usedliked.inherentid=usedwrite.usedid
                LEFT JOIN User
                          ON User.userid = usedwrite.userid
        WHERE usedliked.userid = #{userid}
    </select>


    <!-- 채팅방 정보 저장 -->
    <insert id="saveChatRoom" parameterType="com.project.ribbon.domain.post.PostChatRoomRequest"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO chatroom (
        <include refid="postChatRoomColumns" />
        ) VALUES (
        #{id}
        , #{roomname}
        , #{myid}
        , #{yourid}
        , #{mynickname}
        , #{yournickname}
        , #{myprofileimage}
        , #{yourprofileimage}
        )
    </insert>


    <!-- 특정 채팅방 정보 조회  -->
    <select id="findByMyId" parameterType="Integer" resultType="com.project.ribbon.domain.post.PostChatRoomResponse">
        SELECT
            roomname,yourid,yournickname,yourprofileimage,myid,token
        FROM
            chatroom
                LEFT JOIN User
                          ON User.userid = chatroom.yourid
        WHERE
            myid = #{myid}
    </select>


    <!-- 채팅룸 삭제 -->
    <delete id="deleteByRoomName" >
        DELETE
        FROM
            chatroom
        WHERE roomname = #{roomname}
    </delete>


    <!-- 채팅 정보 저장 -->
    <insert id="saveChat" parameterType="com.project.ribbon.domain.post.PostChatMessage">
        INSERT INTO chattable (
            roomname,nickname,message,profileimage,writedate
        ) VALUES (
                     #{roomname}
                 , #{nickname}
                 , #{message}
                 , #{profileimage}
                 , NOW()
                 )
    </insert>


    <!-- 신고 유저 조회 -->
    <select id="findReportUserAll" resultType="com.project.ribbon.domain.post.PostReportUserResponse">
        SELECT
            *
        FROM reportuser

    </select>

    <!-- 신고 커뮤니티글 조회 -->
    <select id="findReportBoardAll" resultType="com.project.ribbon.domain.post.PostReportBoardResponse">
        SELECT
            *
        FROM reportboard

    </select>
    <!-- 신고 개인글 조회 -->
    <select id="findReportIndividualAll" resultType="com.project.ribbon.domain.post.PostReportIndividualResponse">
        SELECT
            *
        FROM reportindividual

    </select>
    <!-- 신고 단체글 조회 -->
    <select id="findReportGroupAll" resultType="com.project.ribbon.domain.post.PostReportGroupResponse">
        SELECT
            *
        FROM reportgroup

    </select>
    <!-- 신고 중고글 조회 -->
    <select id="findReportUsedAll" resultType="com.project.ribbon.domain.post.PostReportUsedResponse">
        SELECT
            *
        FROM reportused

    </select>
    <!-- 신고 커뮤니티댓글 조회 -->
    <select id="findReportCommentsAll" resultType="com.project.ribbon.domain.post.PostReportCommentsResponse">
        SELECT
            *
        FROM reportcomments

    </select>
    <!-- 신고 개인댓글 조회 -->
    <select id="findReportIndividualCommentsAll" resultType="com.project.ribbon.domain.post.PostReportCommentsResponse">
        SELECT
            *
        FROM reportindividualcomments

    </select>
    <!-- 신고 단체댓글 조회 -->
    <select id="findReportGroupCommentsAll" resultType="com.project.ribbon.domain.post.PostReportCommentsResponse">
        SELECT
            *
        FROM reportgroupcomments

    </select>
    <!-- 신고 중고댓글 조회 -->
    <select id="findReportUsedcommentsAll" resultType="com.project.ribbon.domain.post.PostReportCommentsResponse">
        SELECT
            *
        FROM reportusedcomments

    </select>

    <!-- 채팅룸 삭제 -->
    <delete id="deleteUserReport" >
        DELETE
        FROM
            reportuser
        WHERE userid = #{userid}
    </delete>
</mapper>